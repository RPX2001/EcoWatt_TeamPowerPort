# Flask Directory Files Status

**Date**: October 22, 2025  
**Purpose**: Document which files are actively used vs. legacy/standalone utilities

---

## âœ… ACTIVE FILES (Used by modular server)

### Core Modules
| File | Status | Used By | Purpose |
|------|--------|---------|---------|
| `flask_server_modular.py` | âœ… ACTIVE | Main server | New modular Flask server (175 lines) |
| `server_security_layer.py` | âœ… ACTIVE | handlers/security_handler.py | Security validation, replay protection |
| `fault_injector.py` | âœ… ACTIVE | handlers/fault_handler.py | Fault injection for testing |
| `benchmark_compression.py` | âœ… ACTIVE | Standalone | Python compression validator |

### Modular Architecture (NEW)
| Directory | Files | Status | Purpose |
|-----------|-------|--------|---------|
| `handlers/` | 6 modules | âœ… ACTIVE | Business logic layer |
| `routes/` | 7 modules | âœ… ACTIVE | REST API endpoints |
| `utils/` | 4 modules | âœ… ACTIVE | Shared utilities |

**Total New Files**: 18 modules, ~4,500 lines

---

## ğŸ”§ STANDALONE UTILITY SCRIPTS (Not imported, run manually)

| File | Purpose | Status | Usage |
|------|---------|--------|-------|
| `generate_keys.py` | Generate RSA/AES keys | âœ… UTILITY | Run once: `python3 generate_keys.py` |
| `prepare_firmware.py` | Prepare firmware for OTA | âœ… UTILITY | Run manually: `python3 prepare_firmware.py` |
| `queue_command_for_esp32.py` | Queue commands via CLI | âœ… UTILITY | CLI tool: `python3 queue_command_for_esp32.py set_power 50` |

**These are CLI tools, not imported modules.**

---

## ğŸ“¦ LEGACY FILES (Used by old server, NOT by modular)

| File | Original Purpose | Status | Notes |
|------|------------------|--------|-------|
| `flask_server_hivemq.py` | Original monolithic server | ğŸŸ¡ LEGACY | 2,057 lines, kept for reference |
| `command_manager.py` | Command queue management | ğŸŸ¡ LEGACY | Functionality reimplemented in handlers/command_handler.py |
| `firmware_manager.py` | OTA firmware management | ğŸŸ¡ LEGACY | Functionality reimplemented in handlers/ota_handler.py |
| `config.py` | Configuration (unused) | ğŸ”´ UNUSED | Can be removed |

### Should These Be Removed?

**Recommendation**:
- âœ… **Keep**: `flask_server_hivemq.py` (reference, fallback)
- âœ… **Keep**: `command_manager.py`, `firmware_manager.py` (if prepare_firmware.py or other utilities need them)
- âŒ **Remove**: `config.py` (not imported anywhere)

---

## ğŸ“ DATA DIRECTORIES

| Directory | Contents | Status | Tracked in Git |
|-----------|----------|--------|----------------|
| `diagnostics_data/` | Runtime diagnostics JSON | âœ… ACTIVE | NO (empty, runtime only) |
| `firmware/` | Encrypted firmware files | âœ… ACTIVE | NO (ignored, except .gitkeep) |
| `keys/` | Security keys (RSA, AES) | âœ… ACTIVE | NO (ignored, except .gitkeep) |

---

## ğŸ” IMPORT ANALYSIS

### Who Imports What?

```
flask_server_modular.py
â”œâ”€â”€ utils/mqtt_utils
â”œâ”€â”€ utils/logger_utils
â”œâ”€â”€ routes/* (7 blueprints)
    â””â”€â”€ handlers/* (6 handlers)
        â”œâ”€â”€ utils/compression_utils
        â”œâ”€â”€ utils/data_utils
        â”œâ”€â”€ server_security_layer âœ…
        â””â”€â”€ fault_injector âœ…

flask_server_hivemq.py (LEGACY)
â”œâ”€â”€ command_manager âš ï¸
â”œâ”€â”€ firmware_manager âš ï¸
â”œâ”€â”€ server_security_layer âœ…
â””â”€â”€ fault_injector âœ…

prepare_firmware.py (STANDALONE)
â””â”€â”€ firmware_manager âš ï¸
```

### Conclusion

**Files that MUST stay**:
- `server_security_layer.py` - Used by both servers
- `fault_injector.py` - Used by both servers
- `firmware_manager.py` - Used by `prepare_firmware.py` utility
- `command_manager.py` - Standalone class, could be useful

**Files that CAN be removed**:
- `config.py` - Not imported anywhere

---

## ğŸ“Š .gitignore STATUS

### Current .gitignore Files

1. **Root `.gitignore`** (104 lines)
   - Purpose: Project-wide ignore patterns
   - Status: âœ… Comprehensive, covers all project needs
   
2. **`PIO/ECOWATT/.gitignore`** (5 lines)
   - Purpose: PlatformIO-specific (.pio, .vscode)
   - Status: âœ… Valid, PlatformIO build artifacts
   
3. **`PIO/ECOWATT/.pio/libdeps/wokwi/base64/.gitignore`** (1 line)
   - Purpose: Library-specific (auto-generated)
   - Status: âœ… Generated by library, leave alone

### Recommendation
**NO DUPLICATION** - All .gitignore files serve different purposes:
- Root: Project-wide patterns
- PIO/ECOWATT: PlatformIO-specific
- Library: Auto-generated by dependency

âœ… **All .gitignore files are valid and necessary.**

---

## ğŸ¯ ACTION ITEMS

### Immediate
- [x] Keep all utility scripts (`generate_keys.py`, `prepare_firmware.py`, `queue_command_for_esp32.py`)
- [x] Keep `server_security_layer.py` and `fault_injector.py` (actively used)
- [x] Keep `firmware_manager.py` and `command_manager.py` (used by utilities/legacy)
- [x] Verify `config.py` usage
- [x] Document .gitignore files (all valid)

### Optional Cleanup
- [ ] Remove `config.py` (not imported anywhere)
- [ ] Add deprecation notice to `flask_server_hivemq.py` header
- [ ] Move legacy files to `legacy/` subdirectory (optional organization)

---

## âœ… VERDICT

**Current flask/ directory is CLEAN and ORGANIZED:**
- 18 new modular files (routes, handlers, utils)
- 3 CLI utility scripts (generate_keys, prepare_firmware, queue_command)
- 2 shared libraries (server_security_layer, fault_injector)
- 2 legacy modules (command_manager, firmware_manager) - kept for utilities
- 1 legacy server (flask_server_hivemq.py) - kept for reference
- 1 unused file (config.py) - can be removed

**Status**: âœ… READY TO PROCEED with IMPROVEMENT_PLAN.md tasks
